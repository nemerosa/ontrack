<table class="ot-branch-build-view">
    <thead>
    <!-- Validation stamps -->
    <tr>
        <th colspan="3" rowspan="2">
            <!-- Place holder for builds and promotions -->
            <!-- General commands for the build view -->
            <span class="ot-branch-build-view-auto-refresh"
                  ng-class="{
                    'ot-branch-build-view-auto-refresh-enabled': autoRefresh,
                    'ot-branch-build-view-auto-refresh-disabled': !autoRefresh
                    }"
                  title="{{autoRefresh ? 'Auto refresh is enabled' : 'Auto refresh is disabled'}}"
                  ng-click="toggleAutoRefresh()"
                    ></span>
        </th>
        <!-- All validation stamps -->
        <th ng-repeat="validationStamp in validationStampCollection.resources" class="ot-branch-build-view-validation">
            <ot-entity-image entity="validationStamp" link="#/validationStamp/{{validationStamp.id}}"></ot-entity-image>
        </th>
    </tr>
    <!-- Validation stamps decorations -->
    <tr>
        <!-- For each validation stamp -->
        <th ng-repeat="validationStamp in validationStampCollection.resources" class="ot-branch-build-view-validation">
            <ot-entity-decorations entity="validationStamp"></ot-entity-decorations>
        </th>
    </tr>
    </thead>
    <tbody>
    <tr ng-repeat="buildView in branchBuildView.buildViews">
        <td>
            <span ng-if="branchBuildView.buildDiffActions">
                <input type="radio" id="build-from-{{buildView.build.id}}" name="selectedBuildFrom"
                       ng-model="selectedBuild.from" ng-value="buildView.build.id"/>
                <input type="radio" id="build-to-{{buildView.build.id}}" name="selectedBuildTo"
                       ng-model="selectedBuild.to" ng-value="buildView.build.id"/>
            </span>
            <span ng-if="!branchBuildView.buildDiffActions">&nbsp;</span>
        </td>
        <td>
            <!-- Build name and link -->
            <a href="#/build/{{buildView.build.id}}" class="ot-branch-build-view-build-name">
                {{buildView.build.name}}
                <!-- TODO Build decorations -->
            </a>
            <!-- Signature, without the creator in the overview -->
            <div class="ot-branch-build-view-build-signature">
                {{buildView.build.signature.time | date:'mediumDate'}}
                {{buildView.build.signature.time | date:'shortTime'}}
            </div>
        </td>
        <!-- Promotion runs -->
        <td>
            <span ng-repeat="promotionRun in buildView.promotionRuns">
                <span class="ot-promotion-run">
                    <ot-entity-image entity="promotionRun.promotionLevel"
                                     link="#/promotionLevel/{{promotionRun.promotionLevel.id}}">
                        {{promotionRun.promotionLevel.name}}
                    </ot-entity-image>
                    <span class="ot-promotion-run-signature">
                        {{promotionRun.signature.time | date:'shortDate'}}
                    </span>
                </span>
                <span ng-if="!$last" class="ot-promotion-run-separator"></span>
            </span>
        </td>
        <!-- Validation runs -->
        <td ng-repeat="validationStampRunView in buildView.validationStampRunViews"
            class="ot-branch-build-view-validation">
            <!-- Not run and validation enabled -->
            <span ng-if="!validationStampRunView.run && buildView.build._validate" class="ot-command"
                  ng-click="createValidationRun(buildView, validationStampRunView)">
                <ot-validation-run-status-none></ot-validation-run-status-none>
            </span>
            <!-- Not run and validation not enabled -->
            <span ng-if="!validationStampRunView.run && !buildView.build._validate">
                <ot-validation-run-status-none></ot-validation-run-status-none>
            </span>
            <!-- Last status -->
            <span ng-if="validationStampRunView.run">
                <span class="ot-action" ng-click="displayValidationRuns(buildView, validationStampRunView)">
                    <ot-validation-run-status status="validationStampRunView.lastStatus"></ot-validation-run-status>
                </span>
            </span>
        </td>
    </tr>
    </tbody>
    <tfoot>
    <tr>
        <td colspan="4">
            <!-- Filter command -->
            <div class="btn-group">
                <button type="button" class="btn dropdown-toggle" data-toggle="dropdown"
                        ng-class="{
                        'btn-warning': currentBuildFilterResource,
                        'btn-default': !currentBuildFilterResource
                        }">
                    Filter<span ng-show="currentBuildFilterResource.name">: {{currentBuildFilterResource.name}}</span>
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu ot-buildfilter-list" role="menu">
                    <li role="presentation" class="dropdown-header" ng-if="buildFilterResources">Existing filters:</li>
                    <li ng-repeat="buildFilterResource in buildFilterResources">
                        <a>
                            <span ng-click="buildFilterApply(buildFilterResource)"
                               ng-class="{'ot-buildfilter-local': !buildFilterResource._update, 'ot-buildfilter-remote': buildFilterResource._update}">
                                {{buildFilterResource.name}}
                                <span ng-if="!buildFilterResource._update"> (local)</span>
                            </span>
                            <!-- Saving only if local and logged -->
                            <span class="glyphicon glyphicon-star-empty ot-command" ng-if="!buildFilterResource._update && logged()" ng-click="buildFilterSave(buildFilterResource)"></span>
                            <!-- Deletion always available -->
                            <span class="glyphicon glyphicon-trash ot-command" ng-click="buildFilterRemove(buildFilterResource)"></span>
                        </a>
                    </li>
                    <li class="divider" ng-if="buildFilterResources"></li>
                    <li ng-if="currentBuildFilterResource">
                        <a ng-click="buildFilterErase()">Erase filter</a>
                    </li>
                    <li class="divider" ng-if="currentBuildFilterResource"></li>
                    <!-- New filters -->
                    <li role="presentation" class="dropdown-header">New filter:</li>
                    <li ng-repeat="buildFilterForm in buildFilterForms.resources">
                        <a ng-click="buildFilterNew(buildFilterForm)">{{buildFilterForm.typeName}}</a>
                    </li>
                </ul>
            </div>
            <!-- Build diff extension commands -->
            <button ng-repeat="action in branchBuildView.buildDiffActions" class="btn btn-default"
                    id="{{action.id}}"
                    ng-click="buildDiff(action)">
                {{action.name}}
            </button>
        </td>
    </tr>
    </tfoot>
</table>