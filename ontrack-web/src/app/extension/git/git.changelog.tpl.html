<ot-view>

    <div class="row" ng-hide="changeLog">
        <div class="col-md-12 alert alert-warning">
            <ot-loading>The change log is loading. This may take some time...</ot-loading>
        </div>
    </div>

    <div class="row" ng-show="changeLog">
        <div class="col-md-12">

            <!-- Main content -->
            <div class="row">
                <div class="col-md-12 ot-extension-scm-changelog-commands">
                    <button class="btn btn-default" ng-click="changeLogCommits()" ng-disabled="commitsLoading">
                        <ot-loading ng-if="commitsLoading"></ot-loading>
                        <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="commits || commitsLoading"></span>
                        <span class="ot-extension-scm-changelog-command-loading"></span>
                        {{commitsCommand}}
                    </button>
                    <button ng-if="changeLog._issues" class="btn btn-default" ng-click="changeLogIssues()" ng-disabled="issuesLoading">
                        <ot-loading ng-if="issuesLoading"></ot-loading>
                        <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="issues || issuesLoading"></span>
                        <span class="ot-extension-scm-changelog-command-loading"></span>
                        {{issuesCommand}}
                    </button>
                    <button class="btn btn-default" ng-click="changeLogFiles()" ng-disabled="filesLoading">
                        <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="files"></span>
                        <span class="ot-extension-scm-changelog-command-loading"></span>
                        {{filesCommand}}
                    </button>
                </div>
            </div>

            <!-- Build info -->

            <div class="row">
                <div class="col-md-6">
                    <a name="buildFrom"></a>
                    <ot-scm-changelog-build scm-build-view="changeLog.scmBuildFrom"></ot-scm-changelog-build>
                </div>
                <div class="col-md-6">
                    <a id="buildTo"></a>
                    <ot-scm-changelog-build scm-build-view="changeLog.scmBuildTo"></ot-scm-changelog-build>
                </div>
            </div>

            <!-- Commits sections -->
            <div class="row">
                <div class="col-md-12">
                    <a name="commits"></a>

                    <div class="panel panel-default">
                        <div class="panel-heading clearfix">
                            Commits
                            <div class="pull-right">
                                <a class="btn btn-default btn-xs" ng-if="changeLog._issues" ng-click="changeLogIssues()"
                                   ng-disabled="issuesLoading">
                                    <ot-loading ng-if="issuesLoading"></ot-loading>
                                    <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="issues || issuesLoading"></span>
                                    <span class="ot-extension-scm-changelog-command-loading"></span>
                                    {{issuesCommand}}
                                </a>
                                <a class="btn btn-default btn-xs" ng-click="changeLogFiles()"
                                   ng-disabled="filesLoading">
                                    <ot-loading ng-if="filesLoading"></ot-loading>
                                    <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="files || filesLoading"></span>
                                    <span class="ot-extension-scm-changelog-command-loading"></span>
                                    {{filesCommand}}
                                </a>
                            </div>
                        </div>
                        <div class="panel-body" ng-hide="commits">
                            <div class="alert alert-warning" ng-hide="commits || commitsLoading">
                                No commit has been loaded yet. Click
                                <a ng-click="changeLogCommits()" class="ot-action">here</a>
                                to load them.
                            </div>
                            <div class="ot-description" ng-show="commitsLoading">
                                <ot-loading>Commits are loading...</ot-loading>
                            </div>
                        </div>
                        <table ng-show="commits" class="table">
                            <tbody>
                            <tr>
                                <td valign="top">
                                    <canvas git-plot="commits.log.plot"></canvas>
                                </td>
                                <td valign="top">
                                    <div ng-repeat="gitUICommit in commits.log.commits" class="ot-extension-git-changelog-commit">
                                        <code ng-if="!gitUICommit.link">{{gitUICommit.commit.shortId}}</code>
                                        <code ng-if="gitUICommit.link"><a href="{{gitUICommit.link}}" target="_blank">{{gitUICommit.commit.shortId}}</a></code>
                                        <span class="ot-extension-git-changelog-message" ng-bind-html="gitUICommit.annotatedMessage"></span>
                                        <span class="ot-extension-git-changelog-meta">
                                            <span class="ot-extension-git-changelog-author">{{gitUICommit.commit.author.name}}</span>
                                            <span class="ot-extension-git-changelog-date">
                                                {{gitUICommit.commit.commitTime | date:'mediumDate'}}
                                                {{gitUICommit.commit.commitTime | date:'shortTime'}}
                                            </span>
                                         </span>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Issue sections -->
            <div class="row" ng-if="changeLog._issues">
                <div class="col-md-12">
                    <a name="issues"></a>

                    <div class="panel panel-default">
                        <div class="panel-heading clearfix">
                            Issues
                            <div class="pull-right">
                                <a class="btn btn-default btn-xs" ng-click="changeLogCommits()" ng-disabled="commitsLoading">
                                    <ot-loading ng-if="commitsLoading"></ot-loading>
                                    <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="commits || commitsLoading"></span>
                                    <span class="ot-extension-scm-changelog-command-loading"></span>
                                    {{commitsCommand}}
                                </a>
                                <a class="btn btn-default btn-xs" ng-click="changeLogFiles()" ng-disabled="filesLoading">
                                    <ot-loading ng-if="filesLoading"></ot-loading>
                                    <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="files || filesLoading"></span>
                                    <span class="ot-extension-scm-changelog-command-loading"></span>
                                    {{filesCommand}}
                                </a>
                                <a class="btn btn-default btn-xs" ng-click="changeLogExport()">
                                    <span class="fa fa-file-text-o"></span>
                                    Export
                                </a>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="alert alert-warning" ng-hide="issues || issuesLoading">
                                No issue has been loaded yet. Click
                                <a ng-click="changeLogIssues()" class="ot-action">here</a>
                                to load them.
                            </div>
                            <div class="ot-description" ng-show="issuesLoading">
                                <ot-loading>Issues are loading...</ot-loading>
                            </div>
                            <div ng-show="issues">
                                <ot-include value="issues" template="app/extension/{{issues.issueServiceConfiguration.serviceId}}/changelog.issues.tpl.html">
                                </ot-include>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Files sections -->
            <div class="row">
                <div class="col-md-12">
                    <a name="files"></a>

                    <div class="panel panel-default">
                        <div class="panel-heading clearfix">
                            File changes
                            <div class="pull-right">
                                <a class="btn btn-default btn-xs" ng-click="changeLogCommits()" ng-disabled="commitsLoading">
                                    <ot-loading ng-if="commitsLoading"></ot-loading>
                                    <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="commits || commitsLoading"></span>
                                    <span class="ot-extension-scm-changelog-command-loading"></span>
                                    {{commitsCommand}}
                                </a>
                                <a class="btn btn-default btn-xs" ng-if="changeLog._issues" ng-click="changeLogIssues()" ng-disabled="issuesLoading">
                                    <ot-loading ng-if="issuesLoading"></ot-loading>
                                    <span class="ot-extension-scm-changelog-command-unloaded" ng-hide="issues || issuesLoading"></span>
                                    <span class="ot-extension-scm-changelog-command-loading"></span>
                                    {{issuesCommand}}
                                </a>
                            </div>
                        </div>
                        <div class="panel-body" ng-hide="files || filesLoading">
                            <div class="alert alert-warning">
                                No file change has been loaded yet. Click
                                <a ng-click="changeLogFiles()" class="ot-action">here</a>
                                to load them.
                            </div>
                        </div>
                        <div class="panel-body ot-description" ng-show="filesLoading">
                            <ot-loading>File changes are loading...</ot-loading>
                        </div>
                        <table class="table table-condensed table-hover" ng-show="files" width="100%">
                            <tbody>
                            <tr ng-repeat="changeLogFile in files.list">
                                <td>
                                    <span class="ot-scm-changelog-revision ot-scm-changetype-{{changeLogFile.changeType | lowercase}}">
                                        <span class="ot-scm-changetype-icon" title="{{changeLogFile.changeType | lowercase}}"></span>
                                    </span>
                                    <a href="{{changeLogFile.url}}">{{changeLogFile.oldPath | otExtensionScmTruncatePath:50}}</a>
                                    <span ng-if="changeLogFile.newPath">
                                        <span class="fa fa-arrow-right"></span>
                                        {{changeLogFile.newPath | otExtensionScmTruncatePath:50}}
                                    </span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- End of sections -->

        </div>
    </div>

</ot-view>